---
title: 负载均衡<摘抄>
date: 2018-03-21
tags: 负载均衡
---
原文地址：http://www.hollischuang.com/archives/1844
#### 什么是负载均衡？
  当我们的网站业务量越来越大时，在性能上和稳定性上都承担不小的压力。这是我们通过扩容的方式来提供更好更稳定的服务。我们一般会把多台机器组成一个集群对外提供服务。然而，我们的网站对外提供的入口只有一个，比如www.baidu.com。那么在用户访问www.baidu.com时如何将用户的请求分发到集群中的不同机器上呢，这就是负载均衡在做的事情。

<!-- more -->
#### 负载均衡的分类
  负载均衡就是一种计算机网络技术，用来在多个计算机(计算机集群)、网络连接、CPU、磁碟驱动器或其他资源中分配负载，已达到最佳化资源使用、最大化吞吐率、最小化相应时间、同时避免过载的目的。那么这种计算机技术的实现方式有很多种。大致可以分为以下几种，其中最常用的是四层和七层负载均衡。

二层负载均衡  
  ● 负载均衡服务器对外依然提供一个VIP（虚IP），集群中不同的机器采用相同IP地址，但是机器的MAC地址不一样。当负载均衡服务器接受到请求之后，通过改写报文的目标MAC地址的方式将请求转发到目标机器实现负载均衡。

三层负载均衡  
  ● 和二层负载均衡类似，负载均衡服务器对外依然提供一个VIP（虚IP），但是集群中不同的机器采用不同的IP地址。当负载均衡服务器接受到请求之后，根据不同的负载均衡算法，通过IP将请求转发至不同的真实服务器。

四层负载均衡  
  ● 四层负载均衡工作在OSI模型的传输层，由于在传输层，只有TCP/UDP协议，这两种协议中除了包含源IP、目标IP以外，还包含源端口号及目的端口号。四层负载均衡服务器在接受到客户端请求后，以后通过修改数据包的地址信息（IP+端口号）将流量转发到应用服务器。

七层负载均衡  
  ● 七层负载均衡工作在OSI模型的应用层，应用层协议较多，常用http、radius、dns等。七层负载就可以基于这些协议来负载。这些应用层协议中会包含很多有意义的内容。比如同一个Web服务器的负载均衡，除了根据IP加端口进行负载外，还可根据七层的URL、浏览器类别、语言来决定是否要进行负载均衡。

#### 常用的负载均衡工具-Nginx、LVS、HAProxy
LVS(Linux Virtual Server)  
linux虚拟机服务器，使用LVS技术要达到的目标是，通过LVS提供的负载均衡技术和Linux操作系统实现一个高性能、高可用的服务器群集。

LVS主要用来做四层负载均衡

Nginx  
是一个网页服务器，它能反向代理HTTP、HTTPS、SMTP、POP3、IMAP的协议连接，以及一个负载均衡器和一个HTTP缓存  
Nginx主要用来做七层负载均衡

HAProxy  
HAProxy是一个使用C语言编写的自由及开放源代码软件，其提供高可用性、负载均衡，以及基于TCP和HTTP的应用程序代理  
HAProxy主要用来做七层负载均衡

#### 常见的负载均衡算法  
静态负载均衡算法包括：轮询、比率、优先权

动态负载均衡算法：最少连接数、最快响应速度、观察方法、预测法、动态性能分配、动态服务器补充，服务质量，服务类型、规则模式

#### 番外之七层网络协议

https://www.cnblogs.com/carlos-mm/p/6297197.html  

  OSI是一个开放性的通信系统互联参考模型，他是一个定义的非常好的协议规范。OSI模型有7层结构，其中7、6、5、4层该定义了应用程序的功能，
3、2、1层主要面向通过网络的端到端的数据流，OSI的7层从上到下分别是：  
 
 7.应用层  
（1）文件传输、电子邮件、文件服务、虚拟终端  
（2）TFTP、HTTP、SNMP、FTP、SMTP、DNS、RIP、Telnet

 6.表示层  
（1）数据格式化、代码转换、数据加密  
（2） 无

 5.会话层  
 （1）解除与建立与别的接点的联系  
 （2）无
 
 4.传输层  
 （1）提供端对端的接口  
 （2）TCP、UDP
 
 3.网络层  
 （1）为数据包选择路由  
 （2）IP、ICMP、OSPF、BGP、IGMP、ARP、RARP
 
 2.数据链路层  
 （1）传输有地址的帧以及错误检测功能  
 （2）SLIP、CSLIP、PPP、MTU、ARP、RARP
 
 1.物理层  
（1）以二进制数据形式在物理没提上传输数据  
（2）ISO2110、IEEE802、IEEE802.2